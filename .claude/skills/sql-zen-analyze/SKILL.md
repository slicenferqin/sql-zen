---
name: sql-zen-analyze
description: 分析 SQL 查询结果，提供洞察和建议。当需要理解数据趋势、异常或模式时使用。
context: fork
agent: general
---

# SQL-Zen 数据分析

对查询结果进行深入分析，提供业务洞察。

## 何时使用

- 用户查询结果包含数据集
- 需要理解数据分布和趋势
- 发现异常值或离群点
- 需要业务建议或下一步行动

## 分析步骤

### 1. 数据概览

首先提供基本统计：

```markdown
## 数据概览

- 记录总数: [N 行]
- 查询范围: [时间/数值范围]
- 数据完整性: [完整/部分]
```

### 2. 关键发现

识别并突出显示：

#### 2.1 最大值和最小值

```markdown
### 极值分析

**最大值**: [值] - [含义]
**最小值**: [值] - [含义]
**范围**: [最小] 到 [最大]
```

#### 2.2 异常值或离群点

```markdown
### 异常检测

**异常值**: [显著偏离正常范围的值]
**可能原因**: [分析可能的原因]
**建议**: [如何处理这些异常]
```

#### 2.3 明显的趋势或模式

```markdown
### 趋势分析

**趋势**: [上升/下降/稳定/周期性]
**关键变化**: [描述重要的变化点]
**模式**: [重复出现的模式或规律]
```

### 3. 业务洞察

基于数据分析，提供可行动的洞察：

```markdown
## 业务洞察

### 核心发现
1. [发现一]
2. [发现二]
3. [发现三]

### 影响
- **正面影响**: [对业务的有利影响]
- **潜在风险**: [需要注意的问题]
- **机会**: [可以把握的机会]

### 行动建议
- **立即行动**: [需要立即采取的措施]
- **短期计划**: [未来 1-4 周的建议]
- **长期规划**: [长期优化方向]
```

### 4. 进一步探索建议

如果需要更深入分析，建议：

```markdown
## 进一步分析

### 建议的额外查询
1. [查询一及目的]
2. [查询二及目的]
3. [查询三及目的]

### 对比分析
- [对比维度一]: [建议]
- [对比维度二]: [建议]

### 相关指标
- [指标一]: [为什么重要]
- [指标二]: [为什么重要]
```

## 示例分析

### 示例 1：销售数据分析

用户执行查询: `SELECT * FROM orders WHERE created_at >= '2024-12-01'`

返回 500 条记录

```markdown
## 数据分析报告

### 数据概览
- 记录总数: 500 条
- 查询范围: 2024年 12 月
- 数据完整性: 完整

### 关键发现

**最大订单金额**: ¥12,500 - 12月5日的大订单
**最小订单金额**: ¥50 - 多个小额订单
**平均值**: ¥856 - 平均订单金额
**中位数**: ¥680 - 中等订单金额

### 异常检测

**异常值**: 
- 12月5日的订单（¥12,500）远超平均水平
- 12月15-20日连续 6 天订单金额 < ¥100

**可能原因**: 
- 大订单可能是批发或企业客户
- 小额订单可能是促销期间或测试数据

**建议**: 
- 核实大订单的异常性
- 检查小额订单的业务合理性

### 趋势分析

**趋势**: 月末（25-31日）订单量显著上升
**关键变化**: 12月25日开始，日均订单量增长 40%
**模式**: 工作日订单量是周末的 2.5 倍

### 业务洞察

**核心发现**:
1. 12月是销售旺季，月末订单量激增
2. 存在显著的价格区间差异（¥50 - ¥12,500）
3. 工作日是主要销售时间

**影响**:
- 正面影响: 销售增长趋势良好，季节性明显
- 潜在风险: 月末可能面临物流和客服压力
- 机会: 可以在月末前准备促销活动，进一步拉动销售

**行动建议**:
- 立即行动: 核实异常订单的真实性
- 短期计划: 为月末订单高峰增加客服和物流资源
- 长期规划: 分析季节性模式，优化库存和营销策略

### 进一步分析

**建议的额外查询**:
1. 按产品类别的销售分布
2. 不同客户群体的订单金额对比
3. 与历史同期的对比（2023年12月）
```

### 示例 2：用户行为分析

用户执行查询: `SELECT user_id, COUNT(*) as order_count FROM orders GROUP BY user_id ORDER BY order_count DESC LIMIT 10`

返回 10 个用户的订单统计

```markdown
## 用户行为分析

### 数据概览
- 分析用户: 10 个
- 订单范围: 基于历史所有订单
- 数据完整性: 完整

### 关键发现

**最高订单用户**: 用户123 - 156 个订单
**最低订单用户**: 用户456 - 23 个订单
**平均订单数**: 67 个订单/用户

### 异常检测

**头部用户**: 前 3 个用户占总订单量的 45%
**长尾分布**: 70% 的用户订单数 < 50

### 趋势分析

**模式**: 高频用户集中在 11 月注册（60%）
**趋势**: 订单数分布呈现明显的幂律特征（少部分用户贡献大部分订单）

### 业务洞察

**核心发现**:
1. 存在明显的用户分层（头部用户 vs 长尾用户）
2. 高价值用户集中在特定时间段注册
3. 用户忠诚度差异大（23-156 个订单）

**影响**:
- 正面影响: 头部用户贡献主要收入，易于维护
- 潜在风险: 过度依赖头部用户，流失影响大
- 机会: 长尾用户有较大成长空间

**行动建议**:
- 立即行动: 对头部用户提供专属服务，确保留存
- 短期计划: 针对长尾用户设计提升订单的激励措施
- 长期规划: 建立用户分层运营策略，提升整体粘性

### 进一步分析

**建议的额外查询**:
1. 头部用户的平均订单金额（与订单数对比）
2. 用户流失率和留存率分析
3. 不同注册时间段的用户行为对比
```

## 分析最佳实践

### 1. 数据质量检查

在分析前，检查：
- 数据完整性：是否有缺失值
- 数据准确性：是否有明显错误
- 数据一致性：不同表之间的关联是否正确

### 2. 视角多元化

从多个角度分析数据：
- 时间维度：趋势、周期性、季节性
- 数值维度：分布、极值、平均值
- 分类维度：组别、比例、排名

### 3. 洞察可行动

避免仅描述数据，提供：
- **发现**：数据告诉我们什么
- **影响**：对业务的意义
- **建议**：具体可执行的行动

### 4. 支持分析结论

每个洞察都应该有：
- 数据证据（引用具体数值）
- 逻辑推理（为什么得出这个结论）
- 实际建议（如何应用这个发现）

## 与其他 Skills 配合

### sql-zen-explore

如果分析时需要更多上下文：
```
让我使用 /sql-zen-explore 了解相关表结构
```

### sql-zen-query

如果需要进一步查询来验证分析：
```
让我查询 [进一步的分析问题]
```

## 输出格式

使用 Markdown 格式，结构清晰：
- 使用标题（##, ###）分层
- 使用加粗强调关键信息
- 使用列表呈现要点
- 使用表格对比数据
